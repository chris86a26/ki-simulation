<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KI-Integration im Mittelstand – Lernsimulation</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --primary:#1a365d;--primary-light:#2b6cb0;--primary-lighter:#bee3f8;
  --accent:#2f855a;--accent-light:#c6f6d5;
  --warning:#c05621;--warning-light:#feebc8;
  --danger:#c53030;--danger-light:#fed7d7;
  --gray-50:#f7fafc;--gray-100:#edf2f7;--gray-200:#e2e8f0;--gray-300:#cbd5e0;
  --gray-400:#a0aec0;--gray-500:#718096;--gray-600:#4a5568;--gray-700:#2d3748;--gray-800:#1a202c;
  --white:#fff;--shadow-sm:0 1px 3px rgba(0,0,0,.1);--shadow-md:0 4px 12px rgba(0,0,0,.1);
  --shadow-lg:0 10px 30px rgba(0,0,0,.12);--radius:8px;--radius-lg:12px;--transition:.3s ease;
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:var(--gray-50);color:var(--gray-800);line-height:1.6;min-height:100vh}

/* HEADER */
.header{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:var(--white);padding:1rem 2rem;box-shadow:var(--shadow-md);position:sticky;top:0;z-index:100}
.header-inner{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
.header h1{font-size:1.2rem;font-weight:700;letter-spacing:-.02em}
.header-subtitle{font-size:.82rem;opacity:.85}
.header-right{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
.header-badge{background:rgba(255,255,255,.2);padding:.3rem .8rem;border-radius:20px;font-size:.78rem;font-weight:600}
.header-link{color:rgba(255,255,255,.85);font-size:.78rem;cursor:pointer;text-decoration:underline;text-underline-offset:2px;background:none;border:none;font-family:inherit}
.header-link:hover{color:#fff}

/* MODE TOGGLE */
.mode-toggle{display:flex;align-items:center;gap:.5rem;background:rgba(255,255,255,.15);padding:.3rem .4rem .3rem .75rem;border-radius:20px;font-size:.75rem;font-weight:600}
.mode-toggle span{white-space:nowrap}
.toggle-track{width:40px;height:22px;background:rgba(255,255,255,.3);border-radius:11px;cursor:pointer;position:relative;transition:var(--transition);flex-shrink:0}
.toggle-track.active{background:var(--accent)}
.toggle-thumb{width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:var(--transition);box-shadow:0 1px 3px rgba(0,0,0,.2)}
.toggle-track.active .toggle-thumb{left:20px}

/* PROGRESS */
.progress-container{max-width:1200px;margin:1.25rem auto 0;padding:0 2rem}
.progress-steps{display:flex;justify-content:space-between;position:relative;margin-bottom:.5rem}
.progress-steps::before{content:'';position:absolute;top:16px;left:40px;right:40px;height:3px;background:var(--gray-200);z-index:0}
.progress-fill{position:absolute;top:16px;left:40px;height:3px;background:var(--primary-light);z-index:1;transition:width .6s ease;width:0%}
.step{display:flex;flex-direction:column;align-items:center;position:relative;z-index:2;flex:1}
.step-circle{width:34px;height:34px;border-radius:50%;background:var(--gray-200);border:3px solid var(--gray-300);display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:700;color:var(--gray-500);transition:all var(--transition);margin-bottom:.35rem}
.step.active .step-circle{background:var(--primary-light);border-color:var(--primary);color:#fff;box-shadow:0 0 0 4px rgba(43,108,176,.2)}
.step.completed .step-circle{background:var(--accent);border-color:var(--accent);color:#fff}
.step-label{font-size:.7rem;color:var(--gray-500);text-align:center;font-weight:500;max-width:100px}
.step.active .step-label{color:var(--primary);font-weight:600}
.step.completed .step-label{color:var(--accent)}

/* MAIN */
.main{max-width:1200px;margin:0 auto;padding:1.5rem 2rem 3rem}

/* COMPANY BAR */
.company-bar{background:#fff;border:1px solid var(--gray-200);border-radius:var(--radius);padding:.85rem 1.5rem;margin-bottom:1.5rem;display:flex;flex-wrap:wrap;gap:1.25rem;align-items:center;box-shadow:var(--shadow-sm)}
.company-bar .company-name{font-weight:700;color:var(--primary);font-size:.95rem;margin-right:auto}
.company-stat{text-align:center;font-size:.75rem}
.company-stat .stat-value{font-weight:700;color:var(--gray-700);font-size:.9rem}
.company-stat .stat-label{color:var(--gray-500);font-size:.68rem}

/* SECTIONS */
.round-section,.case-intro-section{display:none;animation:fadeIn .5s ease}
.round-section.active,.case-intro-section.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}

/* ROUND HEADERS */
.round-header{margin-bottom:1.25rem}
.round-tag{display:inline-block;background:var(--primary);color:#fff;font-size:.7rem;font-weight:700;padding:.2rem .7rem;border-radius:20px;text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem}
.round-header h2{font-size:1.45rem;color:var(--gray-800);margin-bottom:.35rem}
.round-header p{color:var(--gray-600);font-size:.9rem}

/* OPTION CARDS */
.options-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.2rem;margin-bottom:1.5rem}
.option-card{background:#fff;border:2px solid var(--gray-200);border-radius:var(--radius-lg);padding:1.4rem;cursor:pointer;transition:all var(--transition);position:relative;box-shadow:var(--shadow-sm)}
.option-card:hover{border-color:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-2px)}
.option-card.selected{border-color:var(--primary);box-shadow:0 0 0 3px rgba(43,108,176,.15),var(--shadow-md)}
.option-card.selected::after{content:'\2713';position:absolute;top:12px;right:14px;width:26px;height:26px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.85rem;font-weight:700}
.option-label{display:inline-block;background:var(--primary-lighter);color:var(--primary);font-size:.7rem;font-weight:700;padding:.15rem .55rem;border-radius:4px;margin-bottom:.5rem}
.option-card h3{font-size:1.05rem;color:var(--gray-800);margin-bottom:.4rem}
.option-card>p{font-size:.83rem;color:var(--gray-600);margin-bottom:.85rem}
.option-metrics{display:grid;grid-template-columns:1fr 1fr;gap:.45rem}
.metric{background:var(--gray-50);padding:.45rem .6rem;border-radius:6px;font-size:.76rem}
.metric .metric-label{color:var(--gray-500);font-size:.66rem;display:block}
.metric .metric-value{font-weight:700;color:var(--gray-700)}
.metric.highlight{background:var(--accent-light)}.metric.highlight .metric-value{color:var(--accent)}
.metric.warning{background:var(--warning-light)}.metric.warning .metric-value{color:var(--warning)}

/* BUTTONS */
.btn-container{text-align:center;margin-top:1rem}
.btn-primary{background:var(--primary);color:#fff;border:none;padding:.8rem 2.2rem;border-radius:var(--radius);font-size:.95rem;font-weight:600;cursor:pointer;transition:all var(--transition);box-shadow:var(--shadow-sm)}
.btn-primary:hover{background:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-1px)}
.btn-primary:disabled{background:var(--gray-300);cursor:not-allowed;transform:none;box-shadow:none}
.btn-secondary{background:#fff;color:var(--primary);border:2px solid var(--primary);padding:.7rem 1.8rem;border-radius:var(--radius);font-size:.9rem;font-weight:600;cursor:pointer;transition:all var(--transition);margin:0 .5rem}
.btn-secondary:hover{background:var(--primary-lighter)}
.btn-ghost{background:none;border:1px solid var(--gray-300);color:var(--gray-600);padding:.6rem 1.4rem;border-radius:var(--radius);font-size:.85rem;cursor:pointer;transition:all var(--transition)}
.btn-ghost:hover{border-color:var(--gray-400);background:var(--gray-50)}

/* FEEDBACK */
.feedback-panel{background:#fff;border-left:4px solid var(--primary);border-radius:0 var(--radius) var(--radius) 0;padding:1.2rem 1.4rem;margin-top:1.5rem;box-shadow:var(--shadow-sm);animation:slideIn .4s ease}
.feedback-panel h4{color:var(--primary);margin-bottom:.45rem;font-size:.92rem}
.feedback-panel p{color:var(--gray-600);font-size:.86rem}
.feedback-score{display:inline-block;font-weight:700;padding:.2rem .7rem;border-radius:4px;font-size:.83rem;margin-top:.45rem}
.feedback-score.good{background:var(--accent-light);color:var(--accent)}
.feedback-score.ok{background:var(--warning-light);color:var(--warning)}
.feedback-score.bad{background:var(--danger-light);color:var(--danger)}

/* KPI DASHBOARD */
.dashboard{background:#fff;border-radius:var(--radius-lg);padding:1.4rem;box-shadow:var(--shadow-md);margin-bottom:1.5rem;border:1px solid var(--gray-200)}
.dashboard h3{font-size:1rem;color:var(--gray-700);margin-bottom:.85rem;padding-bottom:.45rem;border-bottom:1px solid var(--gray-100)}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:.85rem}
.kpi-card{text-align:center;padding:.85rem .4rem;border-radius:var(--radius);background:var(--gray-50);transition:all var(--transition)}
.kpi-card .kpi-value{font-size:1.5rem;font-weight:800;color:var(--primary);display:block}
.kpi-card .kpi-label{font-size:.7rem;color:var(--gray-500);margin-top:.1rem;display:block}
.kpi-card .kpi-change{font-size:.7rem;font-weight:600;margin-top:.25rem;display:block}
.kpi-change.positive{color:var(--accent)}.kpi-change.negative{color:var(--danger)}.kpi-change.neutral{color:var(--gray-500)}
.chart-container{margin-top:1.1rem;padding-top:.85rem;border-top:1px solid var(--gray-100)}
.chart-container h4{font-size:.85rem;color:var(--gray-600);margin-bottom:.6rem}
.chart-svg{width:100%;max-height:200px}

/* FINAL EVAL */
.final-section{display:none;animation:fadeIn .5s ease}.final-section.active{display:block}
.final-score-card{text-align:center;padding:2.5rem 2rem;background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;border-radius:var(--radius-lg);margin-bottom:1.5rem;box-shadow:var(--shadow-lg)}
.final-score-card .big-score{font-size:4rem;font-weight:800;line-height:1}
.final-score-card .score-suffix{font-size:1.5rem;opacity:.8}
.final-score-card .score-label{font-size:1.05rem;opacity:.9;margin-top:.4rem}
.final-score-card .score-grade{display:inline-block;background:rgba(255,255,255,.2);padding:.3rem 1.2rem;border-radius:20px;font-size:.88rem;font-weight:600;margin-top:.7rem}
.decision-summary{background:#fff;border-radius:var(--radius-lg);padding:1.4rem;box-shadow:var(--shadow-md);margin-bottom:1.5rem}
.decision-summary h3{font-size:1.05rem;margin-bottom:.85rem;color:var(--gray-700)}
.decision-item{padding:.9rem;border-radius:var(--radius);margin-bottom:.65rem;border-left:4px solid var(--primary-light);background:var(--gray-50)}
.decision-item .decision-round{font-size:.7rem;font-weight:700;text-transform:uppercase;color:var(--primary-light);letter-spacing:.04em}
.decision-item .decision-choice{font-weight:700;color:var(--gray-800);margin:.15rem 0}
.decision-item .decision-impact{font-size:.83rem;color:var(--gray-600)}
.learning-box{background:var(--accent-light);border-radius:var(--radius-lg);padding:1.4rem;margin-bottom:1.5rem}
.learning-box h3{color:var(--accent);margin-bottom:.7rem}
.learning-box ul{list-style:none;padding:0}
.learning-box li{padding:.35rem 0 .35rem 1.5rem;position:relative;font-size:.88rem;color:var(--gray-700)}
.learning-box li::before{content:'\2714';position:absolute;left:0;color:var(--accent);font-weight:700}

/* ===== CASE INTRO STYLES ===== */
.case-intro-section{text-align:left;padding:0}
.case-hero{text-align:center;padding:2.5rem 1rem 1.5rem}
.case-hero h2{font-size:1.7rem;color:var(--primary);margin-bottom:.6rem}
.case-hero .case-hero-sub{color:var(--gray-600);font-size:.95rem;max-width:650px;margin:0 auto}
.case-nav{display:flex;gap:0;border-bottom:2px solid var(--gray-200);margin-bottom:1.5rem;overflow-x:auto}
.case-nav-btn{background:none;border:none;padding:.7rem 1.2rem;font-size:.82rem;font-weight:600;color:var(--gray-500);cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:all var(--transition);white-space:nowrap;font-family:inherit}
.case-nav-btn:hover{color:var(--gray-700)}
.case-nav-btn.active{color:var(--primary);border-bottom-color:var(--primary)}
.case-panel{display:none;animation:fadeIn .3s ease}
.case-panel.active{display:block}

/* CASE CARDS */
.info-card{background:#fff;border-radius:var(--radius-lg);padding:1.5rem;margin-bottom:1.25rem;box-shadow:var(--shadow-sm);border:1px solid var(--gray-200)}
.info-card h3{font-size:1.1rem;color:var(--gray-800);margin-bottom:.85rem;display:flex;align-items:center;gap:.5rem}
.info-card h3 .ic{font-size:1.3rem}
.info-card h4{font-size:.92rem;color:var(--primary);margin:1rem 0 .5rem}
.info-card p,.info-card li{font-size:.88rem;color:var(--gray-700);line-height:1.65}
.info-card ul{list-style:none;padding:0}
.info-card li{padding:.25rem 0 .25rem 1.3rem;position:relative}
.info-card li::before{content:'\25B8';position:absolute;left:0;color:var(--primary-light);font-weight:700}
.info-card .highlight-value{font-weight:700;color:var(--primary)}

/* STAKEHOLDER CARDS */
.stakeholder-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-top:.75rem}
.stakeholder-card{background:var(--gray-50);border:1px solid var(--gray-200);border-radius:var(--radius);padding:1rem;text-align:center}
.stakeholder-avatar{width:48px;height:48px;border-radius:50%;background:var(--primary-lighter);color:var(--primary);display:flex;align-items:center;justify-content:center;font-size:1.3rem;font-weight:700;margin:0 auto .5rem}
.stakeholder-card h5{font-size:.85rem;color:var(--gray-800);margin-bottom:.15rem}
.stakeholder-card .sh-role{font-size:.72rem;color:var(--gray-500);margin-bottom:.4rem}
.stakeholder-card .sh-concern{font-size:.78rem;color:var(--gray-600);background:#fff;padding:.35rem .5rem;border-radius:4px;border:1px solid var(--gray-200)}

/* SPECIAL BOXES */
.reflection-box{background:#eff6ff;border:1px solid #bfdbfe;border-radius:var(--radius);padding:1rem 1.2rem;margin:1rem 0;font-size:.86rem;color:#1e40af}
.reflection-box .rb-icon{font-weight:700;margin-bottom:.3rem;font-size:.9rem}
.context-box{background:var(--primary-lighter);border-radius:var(--radius);padding:.85rem 1.1rem;margin:.75rem 0;display:inline-flex;flex-wrap:wrap;gap:1.2rem}
.context-item{font-size:.82rem;color:var(--primary)}
.context-item strong{display:block;font-size:1rem}
.caution-box{background:var(--warning-light);border:1px solid #f6ad55;border-radius:var(--radius);padding:.85rem 1.1rem;margin:.75rem 0;font-size:.84rem;color:#7b341e}
.caution-box strong{display:block;margin-bottom:.2rem}
.cta-box{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;border-radius:var(--radius-lg);padding:2rem;text-align:center;margin-top:1.5rem}
.cta-box h3{font-size:1.2rem;margin-bottom:.6rem}
.cta-box p{font-size:.9rem;opacity:.9;margin-bottom:.4rem}
.mode-cards{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin:1.5rem auto;max-width:550px}
.mode-card{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.3);border-radius:var(--radius);padding:1rem;cursor:pointer;transition:all var(--transition);text-align:left}
.mode-card:hover{background:rgba(255,255,255,.25);border-color:rgba(255,255,255,.5)}
.mode-card.selected-mode{background:rgba(255,255,255,.25);border-color:#fff}
.mode-card h4{font-size:.95rem;margin-bottom:.3rem}
.mode-card p{font-size:.78rem;opacity:.85;margin:0}

/* ANALYSIS TASK */
.analysis-section{background:#fff;border:2px solid var(--primary-lighter);border-radius:var(--radius-lg);padding:1.4rem;margin:1.25rem 0;box-shadow:var(--shadow-sm)}
.analysis-section.collapsed .analysis-body{display:none}
.analysis-section h4{font-size:.95rem;color:var(--primary);margin-bottom:.6rem;display:flex;align-items:center;gap:.5rem}
.analysis-prompt{font-size:.86rem;color:var(--gray-700);margin-bottom:.85rem;line-height:1.6;background:var(--gray-50);padding:.85rem;border-radius:var(--radius)}
.analysis-textarea{width:100%;min-height:120px;border:1px solid var(--gray-300);border-radius:var(--radius);padding:.75rem;font-family:inherit;font-size:.88rem;line-height:1.5;resize:vertical;transition:border-color var(--transition);color:var(--gray-800)}
.analysis-textarea:focus{outline:none;border-color:var(--primary-light);box-shadow:0 0 0 3px rgba(43,108,176,.1)}
.analysis-textarea::placeholder{color:var(--gray-400)}
.analysis-footer{display:flex;justify-content:space-between;align-items:center;margin-top:.5rem;font-size:.78rem}
.char-count{color:var(--gray-500)}.char-count.met{color:var(--accent);font-weight:600}.char-count.short{color:var(--danger)}
.example-toggle{color:var(--primary-light);cursor:pointer;text-decoration:underline;font-size:.78rem;background:none;border:none;font-family:inherit}
.example-box{background:var(--gray-50);border:1px dashed var(--gray-300);border-radius:var(--radius);padding:.85rem;margin-top:.65rem;font-size:.83rem;color:var(--gray-600);display:none;line-height:1.55}
.example-box.visible{display:block}
.skip-analysis{color:var(--gray-400);font-size:.8rem;cursor:pointer;background:none;border:none;text-decoration:underline;font-family:inherit;margin-top:.5rem}

/* ACCORDION */
.accordion{border:1px solid var(--gray-200);border-radius:var(--radius);margin:.75rem 0;overflow:hidden}
.accordion-header{background:var(--gray-50);padding:.75rem 1rem;cursor:pointer;font-size:.88rem;font-weight:600;color:var(--gray-700);display:flex;justify-content:space-between;align-items:center;transition:background var(--transition)}
.accordion-header:hover{background:var(--gray-100)}
.accordion-arrow{transition:transform var(--transition);font-size:.75rem;color:var(--gray-400)}
.accordion.open .accordion-arrow{transform:rotate(180deg)}
.accordion-body{padding:0 1rem;max-height:0;overflow:hidden;transition:max-height .35s ease,padding .35s ease}
.accordion.open .accordion-body{max-height:800px;padding:.75rem 1rem}
.accordion-body p,.accordion-body li{font-size:.84rem;color:var(--gray-600);line-height:1.6}
.accordion-body ul{list-style:none;padding:0}
.accordion-body li{padding:.2rem 0 .2rem 1.1rem;position:relative}
.accordion-body li::before{content:'\2022';position:absolute;left:0;color:var(--primary-light)}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;align-items:flex-start;justify-content:center;padding:2rem;overflow-y:auto}
.modal-overlay.open{display:flex}
.modal{background:#fff;border-radius:var(--radius-lg);max-width:800px;width:100%;max-height:85vh;overflow-y:auto;box-shadow:var(--shadow-lg);padding:0}
.modal-header{position:sticky;top:0;background:#fff;padding:1.2rem 1.5rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center;z-index:1}
.modal-header h3{font-size:1.1rem;color:var(--gray-800)}
.modal-close{background:none;border:none;font-size:1.5rem;color:var(--gray-400);cursor:pointer;line-height:1;padding:.25rem}
.modal-close:hover{color:var(--gray-700)}
.modal-body{padding:1.5rem}

/* RESPONSIVE */
@media(max-width:768px){
  .header{padding:.85rem 1.2rem}.header h1{font-size:1rem}
  .main{padding:1rem 1.2rem 2rem}.progress-container{padding:0 1.2rem}
  .options-grid{grid-template-columns:1fr}.kpi-grid{grid-template-columns:repeat(2,1fr)}
  .company-bar{gap:.85rem}.step-label{font-size:.58rem;max-width:65px}
  .case-hero h2{font-size:1.35rem}.final-score-card .big-score{font-size:3rem}
  .stakeholder-grid{grid-template-columns:1fr 1fr}.mode-cards{grid-template-columns:1fr}
  .mode-toggle span.hide-mobile{display:none}
}
@media(max-width:480px){
  .kpi-grid{grid-template-columns:1fr 1fr}.option-metrics{grid-template-columns:1fr}
  .company-bar .company-stat:nth-child(n+4){display:none}
  .stakeholder-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <div>
      <h1>KI-Integration im Mittelstand</h1>
      <div class="header-subtitle">Interaktive Lernsimulation</div>
    </div>
    <div class="header-right">
      <div class="mode-toggle" title="Modus umschalten">
        <span class="hide-mobile">Preview</span>
        <div class="toggle-track" id="modeToggle" onclick="toggleMode()">
          <div class="toggle-thumb"></div>
        </div>
        <span class="hide-mobile">Lern-Modus</span>
      </div>
      <button class="header-link" id="caseBriefLink" onclick="openCaseBrief()" style="display:none">Case-Brief</button>
      <div class="header-badge" id="roundBadge">Case-Brief</div>
    </div>
  </div>
</header>

<!-- PROGRESS -->
<div class="progress-container" id="progressContainer" style="display:none;">
  <div class="progress-steps">
    <div class="progress-fill" id="progressFill"></div>
    <div class="step" data-step="1" id="step1"><div class="step-circle">1</div><div class="step-label">Prozessauswahl</div></div>
    <div class="step" data-step="2" id="step2"><div class="step-circle">2</div><div class="step-label">Build vs. Buy</div></div>
    <div class="step" data-step="3" id="step3"><div class="step-circle">3</div><div class="step-label">Deployment</div></div>
    <div class="step" data-step="4" id="step4"><div class="step-circle">4</div><div class="step-label">Skalierung</div></div>
  </div>
</div>

<!-- CASE BRIEF MODAL -->
<div class="modal-overlay" id="caseBriefModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Case-Brief: TechSupply GmbH</h3>
      <button class="modal-close" onclick="closeCaseBrief()">&times;</button>
    </div>
    <div class="modal-body" id="caseBriefModalBody"></div>
  </div>
</div>

<!-- MAIN CONTENT -->
<main class="main">

  <!-- COMPANY BAR -->
  <div class="company-bar" id="companyBar" style="display:none;">
    <div class="company-name">TechSupply GmbH</div>
    <div class="company-stat"><div class="stat-value">150</div><div class="stat-label">Mitarbeiter</div></div>
    <div class="company-stat"><div class="stat-value">25 Mio. EUR</div><div class="stat-label">Jahresumsatz</div></div>
    <div class="company-stat"><div class="stat-value" id="budgetDisplay">0 EUR</div><div class="stat-label">Kum. Kosten</div></div>
    <div class="company-stat"><div class="stat-value" id="scoreDisplay">0</div><div class="stat-label">Gesamtscore</div></div>
  </div>

  <!-- ========== CASE INTRO ========== -->
  <div class="case-intro-section active" id="caseIntro">
    <div class="case-hero">
      <h2>Willkommen zur Lernsimulation</h2>
      <p class="case-hero-sub">Analysieren Sie ein reales Mittelstandsszenario und treffen Sie strategische Entscheidungen zur KI-Integration. Lesen Sie zuerst den Case-Brief, bevor Sie die Simulation starten.</p>
    </div>

    <!-- Tab Navigation -->
    <nav class="case-nav" id="caseNav">
      <button class="case-nav-btn active" onclick="showCasePanel(0)">Unternehmen</button>
      <button class="case-nav-btn" onclick="showCasePanel(1)">Ihre Rolle</button>
      <button class="case-nav-btn" onclick="showCasePanel(2)">Entscheidungsprozess</button>
      <button class="case-nav-btn" onclick="showCasePanel(3)">Ihre Aufgabe</button>
    </nav>

    <!-- Panel 0: Unternehmen -->
    <div class="case-panel active" id="casePanel0">
      <div class="info-card">
        <h3><span class="ic">&#127970;</span> Unternehmenskontext: TechSupply GmbH</h3>
        <p>Die TechSupply GmbH ist ein mittelständischer B2B-Zulieferer für Industriekomponenten mit Sitz in Süddeutschland.</p>

        <h4>Unternehmensprofil</h4>
        <ul>
          <li>Gegründet: <strong>1987</strong>, inhabergeführt (2. Generation)</li>
          <li>Mitarbeiter: <strong>150</strong> (davon 45 in Verwaltung/Customer Service)</li>
          <li>Jahresumsatz: <strong>25 Mio. EUR</strong> (2025)</li>
          <li>Kunden: <strong>800 B2B-Kunden</strong> (Maschinenbau, Automobilzulieferer, Anlagenbau)</li>
          <li>Wettbewerbsposition: Technologieführer in Nische, aber zunehmender Preisdruck</li>
        </ul>

        <div class="context-box">
          <div class="context-item"><strong>8</strong> MA im Customer Service</div>
          <div class="context-item"><strong>45 Min.</strong> Ø Bearbeitungszeit</div>
          <div class="context-item"><strong>24h</strong> Ø Antwortzeit</div>
          <div class="context-item"><strong>62/100</strong> CSAT-Score</div>
        </div>

        <h4>Strategische Herausforderungen</h4>
        <ul>
          <li><strong>Wachstumsziel:</strong> +20% Umsatz in 2 Jahren ohne proportionale Kostensteigerung</li>
          <li><strong>Effizienz-Problem:</strong> Operative Prozesse sind weitgehend manuell, hohe Fehlerquoten</li>
          <li><strong>Fachkräftemangel:</strong> Offene Stellen im Customer Service seit 8 Monaten unbesetzt</li>
          <li><strong>Wettbewerbsdruck:</strong> Größere Konkurrenten setzen bereits auf AI-Automatisierung</li>
          <li><strong>Generationswechsel:</strong> Seniorchef skeptisch gegenüber "zu viel Technologie", Juniorchefin treibt Digitalisierung</li>
        </ul>

        <div class="caution-box">
          <strong>&#9888;&#65039; Wichtig zu beachten</strong>
          Der Betriebsrat hat bereits signalisiert, dass jede Form der Automatisierung, die Arbeitsplätze gefährdet, auf erheblichen Widerstand stoßen wird. Gleichzeitig steigt das Anfragevolumen um 18% p.a.
        </div>
      </div>

      <div class="reflection-box">
        <div class="rb-icon">&#128161; Reflexionsfrage</div>
        Welche der genannten Herausforderungen hat Ihrer Einschätzung nach die höchste strategische Priorität? Warum?
      </div>
    </div>

    <!-- Panel 1: Ihre Rolle -->
    <div class="case-panel" id="casePanel1">
      <div class="info-card">
        <h3><span class="ic">&#128100;</span> Ihre Rolle: AI Transformation Manager (m/w/d)</h3>
        <p>Sie wurden vor 3 Monaten als <strong>AI Transformation Manager</strong> eingestellt – eine neu geschaffene Position. Sie berichten direkt an die Geschäftsführung (Juniorchefin, MBA, 38 Jahre).</p>

        <h4>Ihr Auftrag</h4>
        <p>Entwickeln und implementieren Sie eine Strategie zur Integration agentischer KI-Systeme, um die operative Effizienz zu steigern und das Wachstum zu ermöglichen – ohne die Unternehmenskultur zu zerstören.</p>

        <div class="context-box">
          <div class="context-item"><strong>150.000 EUR</strong> Budget</div>
          <div class="context-item"><strong>18 Mon.</strong> Max. Break-Even</div>
          <div class="context-item"><strong>0</strong> eigenes Team</div>
          <div class="context-item"><strong>5 J.</strong> Berufserfahrung</div>
        </div>

        <h4>Ihr Background</h4>
        <ul>
          <li>5 Jahre Berufserfahrung in Corporate Strategy</li>
          <li>Zertifizierungen in AI/ML, aber keine tiefe technische Entwicklungs-Erfahrung</li>
          <li>Budget-Verantwortung: 150.000 EUR für das erste AI-Projekt</li>
          <li>Team: Noch keines – Sie müssen cross-funktional arbeiten</li>
        </ul>

        <h4>Ihre Stakeholder</h4>
        <div class="stakeholder-grid">
          <div class="stakeholder-card">
            <div class="stakeholder-avatar">GF</div>
            <h5>Geschäftsführung</h5>
            <div class="sh-role">Juniorchefin, MBA, 38 J.</div>
            <div class="sh-concern">Will schnelle Erfolge, aber risikoavers bei Kundenkontakt</div>
          </div>
          <div class="stakeholder-card">
            <div class="stakeholder-avatar">IT</div>
            <h5>IT-Leiter</h5>
            <div class="sh-role">55 Jahre, kleines Team (4 Pers.)</div>
            <div class="sh-concern">Skeptisch, fürchtet Kontrollverlust über Systeme</div>
          </div>
          <div class="stakeholder-card">
            <div class="stakeholder-avatar">CS</div>
            <h5>CS-Leitung</h5>
            <div class="sh-role">42 Jahre, leitet 8 MA</div>
            <div class="sh-concern">Offen für Entlastung, Sorge um Arbeitsplätze im Team</div>
          </div>
          <div class="stakeholder-card">
            <div class="stakeholder-avatar">BR</div>
            <h5>Betriebsrat</h5>
            <div class="sh-role">Arbeitnehmervertretung</div>
            <div class="sh-concern">Fordert Mitbestimmung, kritisch bei Personalabbau</div>
          </div>
          <div class="stakeholder-card">
            <div class="stakeholder-avatar">CF</div>
            <h5>CFO</h5>
            <div class="sh-role">Finanzvorstand</div>
            <div class="sh-concern">Fokus auf ROI und Cash-Flow, max. 18 Mon. Break-Even</div>
          </div>
        </div>
      </div>

      <div class="reflection-box">
        <div class="rb-icon">&#128161; Reflexionsfrage</div>
        Welcher Stakeholder wird Ihr größter Unterstützer sein – und wer Ihr größter Kritiker? Wie würden Sie mit dem Widerstand umgehen?
      </div>
    </div>

    <!-- Panel 2: Entscheidungsprozess -->
    <div class="case-panel" id="casePanel2">
      <div class="info-card">
        <h3><span class="ic">&#9881;&#65039;</span> Wie Entscheidungen getroffen werden</h3>
        <p>In dieser Simulation treffen Sie strategische Entscheidungen, die den <strong>realen Entscheidungsprozess</strong> in einem mittelständischen Unternehmen simulieren.</p>

        <h4>Schritt 1 – Analyse &amp; Optionenbewertung</h4>
        <p>Sie analysieren die vorliegenden Optionen systematisch anhand betriebswirtschaftlicher Kriterien (TCO, ROI, Risiken, strategische Passung). Im Lern-Modus verfassen Sie dazu eine schriftliche Analyse.</p>

        <h4>Schritt 2 – Stakeholder-Überzeugung (simuliert)</h4>
        <p>Basierend auf Ihrer Analyse müssen Sie Stakeholder überzeugen. Die Simulation bewertet:</p>
        <ul>
          <li>Wie überzeugend ist Ihre Business-Case-Argumentation?</li>
          <li>Haben Sie Risiken und Bedenken adressiert?</li>
          <li>Ist Ihr Plan realistisch und umsetzbar?</li>
        </ul>

        <h4>Schritt 3 – Implementierung &amp; Lernen</h4>
        <p>Nach Ihrer Entscheidung zeigt die Simulation die Konsequenzen über 6–12 Monate. Sie lernen aus Erfolgen und Fehlern und adaptieren in der nächsten Runde.</p>

        <div class="caution-box">
          <strong>&#9888;&#65039; Keine "richtige" Antwort</strong>
          Jede Entscheidung hat Trade-offs. Ihre Aufgabe ist es, begründete, kontextgerechte Entscheidungen zu treffen und deren Konsequenzen zu managen.
        </div>
      </div>
    </div>

    <!-- Panel 3: Aufgabe -->
    <div class="case-panel" id="casePanel3">
      <div class="info-card">
        <h3><span class="ic">&#127919;</span> Ihre Aufgabe heute</h3>
        <p>Die Geschäftsführung hat Sie gebeten, eine <strong>Entscheidungsvorlage</strong> für das erste AI-Projekt zu erarbeiten.</p>

        <h4>Ihr Ziel</h4>
        <ul>
          <li>Identifizieren Sie den vielversprechendsten Prozess für AI-Integration</li>
          <li>Entwickeln Sie eine realistische Implementierungsstrategie</li>
          <li>Überzeugen Sie die Stakeholder mit fundierten Analysen</li>
          <li>Zeigen Sie, wie Sie mit Risiken und Widerständen umgehen</li>
        </ul>

        <h4>Sie durchlaufen 4 Entscheidungsrunden</h4>
        <ul>
          <li><strong>Runde 1:</strong> Process Discovery &amp; Selection</li>
          <li><strong>Runde 2:</strong> Build vs. Buy Decision</li>
          <li><strong>Runde 3:</strong> Deployment Strategy</li>
          <li><strong>Runde 4:</strong> Performance Review &amp; Scaling Decision</li>
        </ul>
        <p style="margin-top:.5rem;font-size:.86rem;">Nach jeder Runde erhalten Sie Feedback zur Qualität Ihrer Entscheidung und sehen die Auswirkungen auf die KPIs.</p>
      </div>

      <!-- CTA with mode selection -->
      <div class="cta-box">
        <h3>Bereit für den Start?</h3>
        <p>Wählen Sie Ihren Simulationsmodus:</p>
        <div class="mode-cards">
          <div class="mode-card" id="modeCardPreview" onclick="selectStartMode(false)">
            <h4>&#128270; Preview-Modus</h4>
            <p>Erkunden Sie alle Runden schnell durch Klicken – ohne Analyse-Pflicht</p>
          </div>
          <div class="mode-card" id="modeCardLearn" onclick="selectStartMode(true)">
            <h4>&#128218; Lern-Modus</h4>
            <p>Vollständige Simulation mit Analyse-Aufgaben (empfohlen)</p>
          </div>
        </div>
        <div class="btn-container" style="margin-top:1rem;">
          <button class="btn-primary" style="background:rgba(255,255,255,.2);border:2px solid #fff;" onclick="startSimulation()">Simulation starten</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== ROUND 1 ========== -->
  <div class="round-section" id="round1">
    <div class="round-header">
      <div class="round-tag">Runde 1 von 4</div>
      <h2>Discovery &amp; Prozessauswahl</h2>
      <p>Welchen Geschäftsprozess möchten Sie zuerst mit einem agentischen KI-System automatisieren? Analysieren Sie die Kennzahlen und wählen Sie strategisch.</p>
    </div>

    <!-- Accordion: Additional Context -->
    <div class="accordion" id="acc1ctx">
      <div class="accordion-header" onclick="toggleAccordion('acc1ctx')">Zusätzliche Kontextinformationen <span class="accordion-arrow">&#9660;</span></div>
      <div class="accordion-body">
        <p><strong>Customer Service:</strong> 8 MA bearbeiten täglich ca. 120 Anfragen per E-Mail und Ticket-System. 65% sind Standardanfragen (Lieferstatus, Preisinformationen, Produktverfügbarkeit). Die Fluktuation im Team liegt bei 25% p.a.</p>
        <p style="margin-top:.5rem;"><strong>Supply Chain:</strong> Prognosen werden manuell in Excel erstellt. Die Überbestandsquote liegt bei 18%, während 12% der Bestellungen aufgrund von Lieferengpässen verzögert werden.</p>
        <p style="margin-top:.5rem;"><strong>Financial Reporting:</strong> Monatsabschlüsse binden 3 Mitarbeiter für 8 Tage. Die Fehlerquote bei manuellen Buchungen liegt bei 4,2%.</p>
      </div>
    </div>

    <div class="options-grid" id="round1Options">
      <div class="option-card" data-round="1" data-option="A" onclick="selectOption(this)">
        <div class="option-label">Option A</div>
        <h3>Customer Service Automation</h3>
        <p>E-Mail- und Ticket-Handling durch einen KI-Agenten automatisieren. Direkte Auswirkung auf Kundenzufriedenheit.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Bearbeitungszeit</span><span class="metric-value">&Oslash; 45 Min./Anfrage</span></div>
          <div class="metric"><span class="metric-label">Jährl. Kosten</span><span class="metric-value">420.000 EUR</span></div>
          <div class="metric highlight"><span class="metric-label">Automatisierungspot.</span><span class="metric-value">72%</span></div>
          <div class="metric highlight"><span class="metric-label">ROI (12 Monate)</span><span class="metric-value">+185%</span></div>
        </div>
      </div>
      <div class="option-card" data-round="1" data-option="B" onclick="selectOption(this)">
        <div class="option-label">Option B</div>
        <h3>Supply Chain Forecasting</h3>
        <p>KI-gestützte Bestandsplanung und Nachfrageprognose. Reduziert Überbestände und Lieferengpässe.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Prognosegenauigkeit</span><span class="metric-value">58% (aktuell)</span></div>
          <div class="metric"><span class="metric-label">Kapitalbindung</span><span class="metric-value">2,1 Mio. EUR</span></div>
          <div class="metric highlight"><span class="metric-label">Automatisierungspot.</span><span class="metric-value">55%</span></div>
          <div class="metric"><span class="metric-label">ROI (12 Monate)</span><span class="metric-value">+95%</span></div>
        </div>
      </div>
      <div class="option-card" data-round="1" data-option="C" onclick="selectOption(this)">
        <div class="option-label">Option C</div>
        <h3>Financial Reporting Automation</h3>
        <p>Automatisierung der Monatsabschlüsse und Finanzberichterstattung. Geringeres Fehlerrisiko.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Abschlussdauer</span><span class="metric-value">8 Arbeitstage</span></div>
          <div class="metric"><span class="metric-label">Jährl. Kosten</span><span class="metric-value">180.000 EUR</span></div>
          <div class="metric highlight"><span class="metric-label">Automatisierungspot.</span><span class="metric-value">45%</span></div>
          <div class="metric warning"><span class="metric-label">ROI (12 Monate)</span><span class="metric-value">+40%</span></div>
        </div>
      </div>
    </div>

    <!-- Analysis Task R1 -->
    <div class="analysis-section" id="analysis1">
      <h4>&#128221; Analyse-Aufgabe (Runde 1)</h4>
      <div class="analysis-prompt">Begründen Sie Ihre Prozessauswahl: Warum ist dieser Prozess der beste Kandidat für das erste KI-Projekt? Berücksichtigen Sie ROI, strategische Passung, Stakeholder-Akzeptanz und Risiken.</div>
      <textarea class="analysis-textarea" id="analysisText1" placeholder="Ihre Analyse hier eingeben..." oninput="updateCharCount(1)"></textarea>
      <div class="analysis-footer">
        <span class="char-count" id="charCount1">0 / 150 Zeichen (Minimum)</span>
        <button class="example-toggle" onclick="toggleExample(1)">Beispielantwort anzeigen</button>
      </div>
      <div class="example-box" id="example1">
        <strong>Beispiel:</strong> Ich empfehle die Customer Service Automation (Option A), da sie das Kernproblem der TechSupply GmbH direkt adressiert: steigende Anfragevolumen bei begrenzten Personalressourcen. Mit 72% Automatisierungspotenzial und einem prognostizierten ROI von +185% bietet dieser Prozess das beste Kosten-Nutzen-Verhältnis. Zudem sind 65% der Anfragen Standardfragen, die sich gut automatisieren lassen. Risiko: Die Mitarbeiterakzeptanz muss durch transparente Kommunikation gesichert werden.
      </div>
      <button class="skip-analysis" id="skipBtn1" onclick="skipAnalysis(1)" style="display:none">Ohne Analyse fortfahren &#8594;</button>
    </div>

    <div class="btn-container">
      <button class="btn-primary" id="btnRound1" disabled onclick="confirmRound(1)">Entscheidung bestätigen</button>
    </div>
    <div id="feedback1"></div>
  </div>

  <!-- ========== ROUND 2 ========== -->
  <div class="round-section" id="round2">
    <div class="round-header">
      <div class="round-tag">Runde 2 von 4</div>
      <h2>Build vs. Buy Entscheidung</h2>
      <p id="round2Intro">Wie möchten Sie die gewählte KI-Lösung umsetzen? Jede Variante hat Auswirkungen auf Budget, Time-to-Market und langfristige Flexibilität.</p>
    </div>

    <div class="accordion" id="acc2ctx">
      <div class="accordion-header" onclick="toggleAccordion('acc2ctx')">Zusätzliche Kontextinformationen <span class="accordion-arrow">&#9660;</span></div>
      <div class="accordion-body">
        <p><strong>IT-Ressourcen:</strong> Das interne IT-Team (4 Personen) ist mit Wartung und Support voll ausgelastet. Für eine Eigenentwicklung müssten 2 externe Entwickler für 6–9 Monate engagiert werden.</p>
        <p style="margin-top:.5rem;"><strong>Marktangebot:</strong> Es gibt 3–4 etablierte SaaS-Anbieter für den gewählten Prozessbereich. Referenzkunden im Mittelstand vorhanden. API-Integration in bestehende Systeme grundsätzlich möglich.</p>
        <p style="margin-top:.5rem;"><strong>Datenlage:</strong> Die TechSupply GmbH verfügt über 5 Jahre historische Daten in ihrem ERP-System. Die Datenqualität ist mittelmäßig (ca. 15% fehlende oder fehlerhafte Einträge).</p>
      </div>
    </div>

    <div class="options-grid" id="round2Options">
      <div class="option-card" data-round="2" data-option="A" onclick="selectOption(this)">
        <div class="option-label">Option A</div>
        <h3>Eigenentwicklung</h3>
        <p>Internes Entwicklungsteam baut maßgeschneiderte Lösung. Volle Kontrolle über Daten und Architektur.</p>
        <div class="option-metrics">
          <div class="metric warning"><span class="metric-label">Investition</span><span class="metric-value">80.000 EUR</span></div>
          <div class="metric warning"><span class="metric-label">Time-to-Market</span><span class="metric-value">6–9 Monate</span></div>
          <div class="metric highlight"><span class="metric-label">Flexibilität</span><span class="metric-value">Sehr hoch</span></div>
          <div class="metric"><span class="metric-label">Tech-Debt-Risiko</span><span class="metric-value">Mittel–Hoch</span></div>
        </div>
      </div>
      <div class="option-card" data-round="2" data-option="B" onclick="selectOption(this)">
        <div class="option-label">Option B</div>
        <h3>SaaS-Lösung kaufen</h3>
        <p>Etablierte Plattform eines Anbieters nutzen. Schnelle Implementierung, aber Abhängigkeit vom Vendor.</p>
        <div class="option-metrics">
          <div class="metric highlight"><span class="metric-label">Jährl. Kosten</span><span class="metric-value">25.000 EUR/Jahr</span></div>
          <div class="metric highlight"><span class="metric-label">Time-to-Market</span><span class="metric-value">4–6 Wochen</span></div>
          <div class="metric"><span class="metric-label">Flexibilität</span><span class="metric-value">Eingeschränkt</span></div>
          <div class="metric"><span class="metric-label">Vendor Lock-in</span><span class="metric-value">Hoch</span></div>
        </div>
      </div>
      <div class="option-card" data-round="2" data-option="C" onclick="selectOption(this)">
        <div class="option-label">Option C</div>
        <h3>Hybrid-Ansatz</h3>
        <p>SaaS-Kern mit eigenen Anpassungen kombinieren. Balanciert Geschwindigkeit und Kontrolle.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Initialkosten</span><span class="metric-value">50.000 EUR</span></div>
          <div class="metric"><span class="metric-label">+ Laufend</span><span class="metric-value">15.000 EUR/Jahr</span></div>
          <div class="metric highlight"><span class="metric-label">Time-to-Market</span><span class="metric-value">2–3 Monate</span></div>
          <div class="metric highlight"><span class="metric-label">Flexibilität</span><span class="metric-value">Hoch</span></div>
        </div>
      </div>
    </div>

    <div class="analysis-section" id="analysis2">
      <h4>&#128221; Analyse-Aufgabe (Runde 2)</h4>
      <div class="analysis-prompt">Vergleichen Sie die TCO (Total Cost of Ownership) über 3 Jahre für alle drei Optionen. Welche Faktoren neben den direkten Kosten beeinflussen Ihre Entscheidung? Wie würden Sie den IT-Leiter überzeugen?</div>
      <textarea class="analysis-textarea" id="analysisText2" placeholder="Ihre Analyse hier eingeben..." oninput="updateCharCount(2)"></textarea>
      <div class="analysis-footer">
        <span class="char-count" id="charCount2">0 / 150 Zeichen (Minimum)</span>
        <button class="example-toggle" onclick="toggleExample(2)">Beispielantwort anzeigen</button>
      </div>
      <div class="example-box" id="example2">
        <strong>Beispiel:</strong> TCO-Vergleich über 3 Jahre: Eigenentwicklung: 80k + laufende Wartung (~20k/J.) = ~140k. SaaS: 25k x 3 = 75k, aber Vendor Lock-in und begrenzte Anpassbarkeit. Hybrid: 50k + 15k x 3 = 95k, mit guter Balance. Den IT-Leiter überzeuge ich, indem die SaaS-Basis die operative Last reduziert, während die Anpassungsschicht ihm Kontrolle über die Integration gibt. Wichtig: Die Datenhoheit muss vertraglich gesichert werden.
      </div>
      <button class="skip-analysis" id="skipBtn2" onclick="skipAnalysis(2)" style="display:none">Ohne Analyse fortfahren &#8594;</button>
    </div>

    <div class="btn-container">
      <button class="btn-primary" id="btnRound2" disabled onclick="confirmRound(2)">Entscheidung bestätigen</button>
    </div>
    <div id="feedback2"></div>
  </div>

  <!-- ========== ROUND 3 ========== -->
  <div class="round-section" id="round3">
    <div class="round-header">
      <div class="round-tag">Runde 3 von 4</div>
      <h2>Deployment-Strategie</h2>
      <p>Wie führen Sie die KI-Lösung im Unternehmen ein? Ihre Strategie beeinflusst Mitarbeiterakzeptanz, Fehlerwahrscheinlichkeit und Geschwindigkeit des ROI.</p>
    </div>

    <div class="accordion" id="acc3ctx">
      <div class="accordion-header" onclick="toggleAccordion('acc3ctx')">Zusätzliche Kontextinformationen <span class="accordion-arrow">&#9660;</span></div>
      <div class="accordion-body">
        <p><strong>Change-Readiness:</strong> Eine interne Umfrage ergab, dass 40% der Mitarbeiter "besorgt" über KI-Einführung sind, 35% "neutral" und 25% "positiv". Die CS-Teamleiterin hat Unterstützung signalisiert.</p>
        <p style="margin-top:.5rem;"><strong>Betriebsrat:</strong> Hat eine Betriebsvereinbarung zur "Einführung digitaler Systeme" gefordert. Verhandlungen laufen, ein Entwurf liegt vor. Kernforderung: Keine betriebsbedingten Kündigungen für 24 Monate.</p>
        <p style="margin-top:.5rem;"><strong>Trainingskapazitäten:</strong> Das Unternehmen hat kein internes Schulungsteam. Externe Trainer kosten ca. 2.000 EUR pro Schulungstag.</p>
      </div>
    </div>

    <div class="options-grid" id="round3Options">
      <div class="option-card" data-round="3" data-option="A" onclick="selectOption(this)">
        <div class="option-label">Option A</div>
        <h3>Pilotprojekt</h3>
        <p>Start mit einem Team (3 Mitarbeiter) über 3 Monate. Erkenntnisse sammeln, dann ausweiten.</p>
        <div class="option-metrics">
          <div class="metric highlight"><span class="metric-label">Risiko</span><span class="metric-value">Gering</span></div>
          <div class="metric highlight"><span class="metric-label">Akzeptanz</span><span class="metric-value">Hoch (schrittweise)</span></div>
          <div class="metric warning"><span class="metric-label">ROI-Zeitrahmen</span><span class="metric-value">9–12 Monate</span></div>
          <div class="metric"><span class="metric-label">Change Mgmt.</span><span class="metric-value">Überschaubar</span></div>
        </div>
      </div>
      <div class="option-card" data-round="3" data-option="B" onclick="selectOption(this)">
        <div class="option-label">Option B</div>
        <h3>Schrittweise Einführung</h3>
        <p>50% der Prozesse in 6 Monaten umstellen. Parallelbetrieb von alt und neu während der Transition.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Risiko</span><span class="metric-value">Mittel</span></div>
          <div class="metric"><span class="metric-label">Akzeptanz</span><span class="metric-value">Mittel</span></div>
          <div class="metric highlight"><span class="metric-label">ROI-Zeitrahmen</span><span class="metric-value">6–9 Monate</span></div>
          <div class="metric"><span class="metric-label">Change Mgmt.</span><span class="metric-value">Intensiv</span></div>
        </div>
      </div>
      <div class="option-card" data-round="3" data-option="C" onclick="selectOption(this)">
        <div class="option-label">Option C</div>
        <h3>Big Bang</h3>
        <p>Sofortige, vollständige Umstellung aller Prozesse. Maximaler Zeitdruck, aber schnellster ROI bei Erfolg.</p>
        <div class="option-metrics">
          <div class="metric warning"><span class="metric-label">Risiko</span><span class="metric-value">Hoch</span></div>
          <div class="metric warning"><span class="metric-label">Akzeptanz</span><span class="metric-value">Niedrig (Widerstand)</span></div>
          <div class="metric highlight"><span class="metric-label">ROI-Zeitrahmen</span><span class="metric-value">3–6 Monate</span></div>
          <div class="metric warning"><span class="metric-label">Fehlerwahrsch.</span><span class="metric-value">35%</span></div>
        </div>
      </div>
    </div>

    <div class="analysis-section" id="analysis3">
      <h4>&#128221; Analyse-Aufgabe (Runde 3)</h4>
      <div class="analysis-prompt">Erstellen Sie einen groben Change-Management-Plan für Ihre gewählte Deployment-Strategie. Wie adressieren Sie die Bedenken des Betriebsrats und der 40% besorgten Mitarbeiter?</div>
      <textarea class="analysis-textarea" id="analysisText3" placeholder="Ihre Analyse hier eingeben..." oninput="updateCharCount(3)"></textarea>
      <div class="analysis-footer">
        <span class="char-count" id="charCount3">0 / 150 Zeichen (Minimum)</span>
        <button class="example-toggle" onclick="toggleExample(3)">Beispielantwort anzeigen</button>
      </div>
      <div class="example-box" id="example3">
        <strong>Beispiel:</strong> Change-Management-Plan für schrittweise Einführung: (1) Kick-off-Meeting mit dem gesamten CS-Team, um die Vorteile aufzuzeigen – die KI übernimmt Routineanfragen, Menschen bearbeiten komplexe Fälle. (2) Betriebsvereinbarung unterzeichnen mit 24-Monate-Beschäftigungsgarantie. (3) 3 "KI-Champions" aus dem Team benennen, die als Multiplikatoren wirken. (4) Wöchentliche Feedback-Runden. (5) Transparentes KPI-Dashboard, das auch die Mitarbeiter einsehen können.
      </div>
      <button class="skip-analysis" id="skipBtn3" onclick="skipAnalysis(3)" style="display:none">Ohne Analyse fortfahren &#8594;</button>
    </div>

    <div class="btn-container">
      <button class="btn-primary" id="btnRound3" disabled onclick="confirmRound(3)">Entscheidung bestätigen</button>
    </div>
    <div id="feedback3"></div>
  </div>

  <!-- ========== ROUND 4 ========== -->
  <div class="round-section" id="round4">
    <div class="round-header">
      <div class="round-tag">Runde 4 von 4</div>
      <h2>Performance Review &amp; Skalierung</h2>
      <p id="round4Intro">Basierend auf den bisherigen Ergebnissen: Wie gehen Sie nun strategisch weiter vor?</p>
    </div>

    <div class="dashboard" id="dashboardR4">
      <h3>Aktuelle KPI-Übersicht nach Einführung</h3>
      <div class="kpi-grid" id="kpiGridR4"></div>
      <div class="chart-container">
        <h4>KPI-Verlauf über alle Runden</h4>
        <svg id="chartR4" class="chart-svg" viewBox="0 0 600 200"></svg>
      </div>
    </div>

    <div class="options-grid" id="round4Options">
      <div class="option-card" data-round="4" data-option="A" onclick="selectOption(this)">
        <div class="option-label">Option A</div>
        <h3>Weiter skalieren</h3>
        <p>Erfolge nutzen und KI-Agenten auf weitere Abteilungen ausweiten (Einkauf, Vertrieb, HR).</p>
        <div class="option-metrics">
          <div class="metric highlight"><span class="metric-label">Potenzial</span><span class="metric-value">Sehr hoch</span></div>
          <div class="metric warning"><span class="metric-label">Zusatzkosten</span><span class="metric-value">+40.000 EUR</span></div>
          <div class="metric"><span class="metric-label">Risiko</span><span class="metric-value">Mittel</span></div>
          <div class="metric highlight"><span class="metric-label">Langfrist-ROI</span><span class="metric-value">+250%</span></div>
        </div>
      </div>
      <div class="option-card" data-round="4" data-option="B" onclick="selectOption(this)">
        <div class="option-label">Option B</div>
        <h3>Optimieren &amp; konsolidieren</h3>
        <p>Bestehende Lösung stabilisieren, Feintuning durchführen, Prozesse verbessern.</p>
        <div class="option-metrics">
          <div class="metric highlight"><span class="metric-label">Risiko</span><span class="metric-value">Gering</span></div>
          <div class="metric highlight"><span class="metric-label">Zusatzkosten</span><span class="metric-value">+10.000 EUR</span></div>
          <div class="metric"><span class="metric-label">Potenzial</span><span class="metric-value">Moderat</span></div>
          <div class="metric"><span class="metric-label">Langfrist-ROI</span><span class="metric-value">+120%</span></div>
        </div>
      </div>
      <div class="option-card" data-round="4" data-option="C" onclick="selectOption(this)">
        <div class="option-label">Option C</div>
        <h3>Strategie anpassen</h3>
        <p>Probleme adressieren, teilweise zurückfahren, neue Herangehensweise entwickeln.</p>
        <div class="option-metrics">
          <div class="metric"><span class="metric-label">Risiko</span><span class="metric-value">Gering</span></div>
          <div class="metric warning"><span class="metric-label">Zusatzkosten</span><span class="metric-value">+20.000 EUR</span></div>
          <div class="metric"><span class="metric-label">Potenzial</span><span class="metric-value">Variabel</span></div>
          <div class="metric warning"><span class="metric-label">Zeitverlust</span><span class="metric-value">3–6 Monate</span></div>
        </div>
      </div>
    </div>

    <div class="analysis-section" id="analysis4">
      <h4>&#128221; Analyse-Aufgabe (Runde 4)</h4>
      <div class="analysis-prompt">Reflektieren Sie Ihre bisherige Strategie anhand der KPIs. Was lief gut, was weniger? Begründen Sie Ihre nächste strategische Entscheidung und wie Sie diese gegenüber der Geschäftsführung und dem CFO argumentieren würden.</div>
      <textarea class="analysis-textarea" id="analysisText4" placeholder="Ihre Analyse hier eingeben..." oninput="updateCharCount(4)"></textarea>
      <div class="analysis-footer">
        <span class="char-count" id="charCount4">0 / 150 Zeichen (Minimum)</span>
        <button class="example-toggle" onclick="toggleExample(4)">Beispielantwort anzeigen</button>
      </div>
      <div class="example-box" id="example4">
        <strong>Beispiel:</strong> Die KPIs zeigen eine positive Entwicklung bei Prozesseffizienz und Kundenzufriedenheit, während die Mitarbeiterakzeptanz leicht gesunken ist. Ich empfehle Konsolidierung (Option B): Die Fehlerrate muss gesenkt und die Akzeptanz gesteigert werden, bevor wir skalieren. Gegenüber dem CFO argumentiere ich, dass die geringeren Zusatzkosten (10k vs. 40k) bei gleichzeitiger Optimierung den ROI pro investiertem Euro maximieren. Skalierung kann im nächsten Quartal erfolgen, wenn die KPIs stabil sind.
      </div>
      <button class="skip-analysis" id="skipBtn4" onclick="skipAnalysis(4)" style="display:none">Ohne Analyse fortfahren &#8594;</button>
    </div>

    <div class="btn-container">
      <button class="btn-primary" id="btnRound4" disabled onclick="confirmRound(4)">Entscheidung bestätigen</button>
    </div>
    <div id="feedback4"></div>
  </div>

  <!-- ========== KPI DASHBOARD (between rounds) ========== -->
  <div class="dashboard" id="dashboardMain" style="display:none;">
    <h3>KPI-Dashboard</h3>
    <div class="kpi-grid" id="kpiGridMain"></div>
    <div class="chart-container"><h4>KPI-Verlauf</h4><svg id="chartMain" class="chart-svg" viewBox="0 0 600 200"></svg></div>
  </div>

  <!-- ========== FINAL EVALUATION ========== -->
  <div class="final-section" id="finalSection">
    <div class="final-score-card" id="finalScoreCard">
      <div class="big-score" id="finalBigScore">0</div>
      <div class="score-suffix">von 100 Punkten</div>
      <div class="score-label" id="finalScoreLabel">Gesamtbewertung</div>
      <div class="score-grade" id="finalGrade"></div>
    </div>
    <div class="dashboard" id="dashboardFinal">
      <h3>Finale KPI-Übersicht</h3>
      <div class="kpi-grid" id="kpiGridFinal"></div>
      <div class="chart-container"><h4>KPI-Entwicklung über alle Runden</h4><svg id="chartFinal" class="chart-svg" viewBox="0 0 600 200"></svg></div>
    </div>
    <div class="decision-summary" id="decisionSummary">
      <h3>Ihre Entscheidungen im Überblick</h3>
      <div id="decisionList"></div>
    </div>
    <div class="learning-box" id="learningBox">
      <h3>Didaktische Erkenntnisse</h3>
      <ul id="learningList"></ul>
    </div>
    <div class="btn-container">
      <button class="btn-primary" onclick="restartSimulation()">Simulation neu starten</button>
      <button class="btn-secondary" onclick="showDetailedAnalysis()">Detailanalyse anzeigen</button>
    </div>
    <div id="detailedAnalysis" style="display:none;margin-top:1.5rem;"></div>
  </div>

</main>

<script>
/* ===============================================================
   SIMULATION ENGINE – EXPANDED VERSION
   =============================================================== */

// ---- STATE ----
const state = {
  currentRound: 0,
  choices: {},
  scores: [],
  totalScore: 0,
  kpiHistory: [],
  kpis: { roi: 0, csat: 62, acceptance: 70, efficiency: 0, errorRate: 12, cost: 0 },
  learnMode: false,
  analyses: {}
};

const MIN_CHARS = 150;

// ---- DATA TABLES ----
const round1Data = {
  A: { name:'Customer Service Automation', score:28,
    kpiDelta:{roi:15,csat:8,acceptance:-3,efficiency:18,errorRate:-2,cost:0},
    feedback:'Ausgezeichnete Wahl. Der Customer Service hat das höchste Automatisierungspotenzial und den direktesten Einfluss auf die Kundenzufriedenheit. Die 72% Automatisierungspotenzial versprechen einen schnellen ROI. Beachten Sie jedoch, dass die Mitarbeiter im Service befürchten könnten, ersetzt zu werden.' },
  B: { name:'Supply Chain Forecasting', score:22,
    kpiDelta:{roi:8,csat:3,acceptance:2,efficiency:12,errorRate:-1,cost:0},
    feedback:'Eine solide, wenn auch konservative Entscheidung. Supply Chain Forecasting bietet zwar einen guten ROI, hat aber weniger direkten Einfluss auf die Kundenzufriedenheit \u2013 dem Kernproblem der TechSupply GmbH. Der Vorteil: Die Mitarbeiterakzeptanz ist höher, da keine Arbeitsplätze direkt betroffen sind.' },
  C: { name:'Financial Reporting Automation', score:15,
    kpiDelta:{roi:4,csat:1,acceptance:5,efficiency:8,errorRate:-3,cost:0},
    feedback:'Eine risikoarme, aber strategisch suboptimale Wahl. Financial Reporting hat das geringste Automatisierungspotenzial und adressiert nicht das Kernproblem steigender Kundenanfragen. Zwar sinkt die Fehlerrate deutlich, aber der ROI bleibt bescheiden. Für einen Mittelständler mit akutem Serviceproblem wäre ein kundennaher Prozess wirkungsvoller.' }
};

const round2Data = {
  A: { name:'Eigenentwicklung', score:18,
    kpiDelta:{roi:-5,csat:-2,acceptance:3,efficiency:5,errorRate:1,cost:80000},
    feedback:'Eigenentwicklung gibt Ihnen maximale Kontrolle, aber die lange Time-to-Market (6\u20139 Monate) ist für ein Mittelstandsunternehmen mit akutem Problem riskant. Die 80.000 EUR Initialinvestition bindet zudem signifikantes Budget. Positiv: Kein Vendor Lock-in und volle Datenhoheit.' },
  B: { name:'SaaS-Lösung', score:22,
    kpiDelta:{roi:10,csat:5,acceptance:-2,efficiency:10,errorRate:-1,cost:25000},
    feedback:'Die SaaS-Lösung bietet den schnellsten Weg zur Umsetzung und die niedrigsten Initialkosten. Für ein Mittelstandsunternehmen ist die schnelle Time-to-Market (4\u20136 Wochen) ein großer Vorteil. Beachten Sie jedoch das Vendor Lock-in-Risiko und die eingeschränkte Anpassbarkeit an Ihre spezifischen Prozesse.' },
  C: { name:'Hybrid-Ansatz', score:25,
    kpiDelta:{roi:5,csat:3,acceptance:2,efficiency:8,errorRate:-1,cost:50000},
    feedback:'Der Hybrid-Ansatz ist für einen Mittelständler oft die klügste Wahl: Sie nutzen eine bewährte SaaS-Basis und passen diese an Ihre Bedürfnisse an. Die Balance zwischen Time-to-Market (2\u20133 Monate) und Flexibilität ist für die TechSupply GmbH gut geeignet. Die Gesamtkosten sind moderat.' }
};

const round3Data = {
  A: { name:'Pilotprojekt', score:22,
    kpiDelta:{roi:3,csat:4,acceptance:12,efficiency:5,errorRate:-2,cost:5000},
    feedback:'Das Pilotprojekt ist die sicherste Strategie mit der höchsten Mitarbeiterakzeptanz. Die schrittweise Einführung erlaubt es, aus Fehlern zu lernen und Prozesse anzupassen. Nachteil: Der ROI realisiert sich deutlich langsamer. Für die TechSupply GmbH mit ihrem akuten Problem könnte die Geduld der Geschäftsführung auf die Probe gestellt werden.' },
  B: { name:'Schrittweise Einführung', score:24,
    kpiDelta:{roi:8,csat:6,acceptance:5,efficiency:10,errorRate:-1,cost:12000},
    feedback:'Die schrittweise Einführung bietet einen guten Kompromiss: 50% der Prozesse werden in 6 Monaten umgestellt, was schnellere Ergebnisse als ein Pilotprojekt liefert, ohne das volle Risiko eines Big Bang. Der Parallelbetrieb erhöht temporär die Komplexität, sichert aber den laufenden Betrieb ab.' },
  C: { name:'Big Bang', score:14,
    kpiDelta:{roi:12,csat:-4,acceptance:-15,efficiency:15,errorRate:5,cost:8000},
    feedback:'Die Big-Bang-Einführung ist die riskanteste Strategie. Zwar ist der potenzielle ROI am schnellsten, aber die 35% Fehlerwahrscheinlichkeit und der massive Widerstand der Mitarbeiter können den gesamten Projekterfolg gefährden. Für ein Mittelstandsunternehmen ohne dediziertes Change-Management-Team ist diese Strategie besonders riskant.' }
};

const round4Data = {
  A: { name:'Weiter skalieren', baseScore:20,
    kpiDelta:{roi:18,csat:5,acceptance:-5,efficiency:12,errorRate:2,cost:40000},
    feedback:'Skalierung auf weitere Abteilungen maximiert den langfristigen ROI, birgt aber das Risiko der Überdehnung. {dynamic}' },
  B: { name:'Optimieren & konsolidieren', baseScore:22,
    kpiDelta:{roi:8,csat:8,acceptance:8,efficiency:6,errorRate:-3,cost:10000},
    feedback:'Konsolidierung ist oft die unterschätzte, aber kluge Entscheidung. {dynamic}' },
  C: { name:'Strategie anpassen', baseScore:15,
    kpiDelta:{roi:-5,csat:2,acceptance:5,efficiency:-3,errorRate:-2,cost:20000},
    feedback:'Einen Schritt zurückzugehen erfordert Mut, kann aber langfristig die bessere Entscheidung sein. {dynamic}' }
};

// ---- COMBO BONUSES ----
function getComboBonus() {
  const c = state.choices; let bonus = 0, notes = [];
  if(c[1]==='A'&&c[2]==='C'){bonus+=5;notes.push('Synergiebonus: Customer Service + Hybrid-Ansatz ist eine ausgewogene Kombination.');}
  if(c[1]==='A'&&c[2]==='B'){bonus+=3;notes.push('Die SaaS-Lösung für Customer Service bietet schnelle Ergebnisse.');}
  if(c[3]==='C'&&c[2]==='A'){bonus-=5;notes.push('Achtung: Big Bang mit Eigenentwicklung ist besonders riskant \u2013 die unreife Lösung wird sofort allen zugemutet.');}
  if(c[3]==='A'&&c[1]==='A'){bonus+=3;notes.push('Ein Pilotprojekt im Customer Service erlaubt direktes Kundenfeedback.');}
  if(c[3]==='B'&&c[2]==='C'){bonus+=4;notes.push('Schrittweise Einführung mit Hybrid-Ansatz: Gute Balance zwischen Geschwindigkeit und Sicherheit.');}
  return {bonus,notes};
}

// ---- ROUND 4 DYNAMIC ----
function getRound4Score(option) {
  const base = round4Data[option].baseScore; let mod = 0;
  if(option==='A'){if(state.kpis.acceptance>=70&&state.kpis.csat>=70)mod=8;else if(state.kpis.acceptance<50||state.kpis.errorRate>15)mod=-8;else mod=2;}
  if(option==='B'){if(state.kpis.errorRate>10||state.kpis.acceptance<60)mod=6;else mod=2;}
  if(option==='C'){if(state.kpis.csat<60||state.kpis.acceptance<50)mod=10;else mod=-3;}
  return base+mod;
}

function getRound4DynamicFeedback(option) {
  let d='';
  if(option==='A'){
    if(state.kpis.acceptance>=70&&state.kpis.csat>=70)d='Ihre bisherigen KPIs sind stark genug, um eine Skalierung zu rechtfertigen. Die hohe Mitarbeiterakzeptanz und Kundenzufriedenheit bilden ein solides Fundament.';
    else if(state.kpis.acceptance<50)d='Vorsicht: Bei einer Mitarbeiterakzeptanz unter 50% riskieren Sie mit Skalierung erheblichen Widerstand in weiteren Abteilungen. Eine Konsolidierung wäre ratsamer gewesen.';
    else d='Ihre KPIs sind gemischt. Skalierung ist möglich, aber Sie sollten die identifizierten Schwachstellen parallel adressieren.';
  } else if(option==='B'){
    if(state.kpis.errorRate>10)d='Angesichts der erhöhten Fehlerrate ist Konsolidierung die richtige Entscheidung. Stabilisierung vor Expansion ist ein bewährtes Prinzip im IT-Projektmanagement.';
    else d='Die Konsolidierung stärkt Ihre bestehende Lösung. Obwohl kurzfristig weniger spektakulär, sichert dies den langfristigen Erfolg und baut technische Schulden ab.';
  } else {
    if(state.kpis.csat<60||state.kpis.acceptance<50)d='Angesichts der schwachen KPIs ist ein Strategiewechsel die vernünftige Entscheidung. Es zeugt von professioneller Reife, Fehlentwicklungen frühzeitig zu korrigieren.';
    else d='Ihre KPIs deuten nicht auf gravierende Probleme hin. Ein Strategiewechsel in dieser Situation verursacht unnötige Kosten und Zeitverlust.';
  }
  return round4Data[option].feedback.replace('{dynamic}',d);
}

// ---- KPI LOGIC ----
function applyKpiDelta(delta) {
  state.kpis.roi=Math.max(0,Math.min(300,state.kpis.roi+delta.roi));
  state.kpis.csat=Math.max(0,Math.min(100,state.kpis.csat+delta.csat));
  state.kpis.acceptance=Math.max(0,Math.min(100,state.kpis.acceptance+delta.acceptance));
  state.kpis.efficiency=Math.max(0,Math.min(100,state.kpis.efficiency+delta.efficiency));
  state.kpis.errorRate=Math.max(0,Math.min(50,state.kpis.errorRate+delta.errorRate));
  state.kpis.cost+=delta.cost;
}
function snapshotKpis(){state.kpiHistory.push({...state.kpis});}

// ---- MODE TOGGLE ----
function toggleMode() {
  state.learnMode = !state.learnMode;
  const track = document.getElementById('modeToggle');
  track.classList.toggle('active', state.learnMode);
  applyModeToUI();
}

function selectStartMode(learn) {
  state.learnMode = learn;
  document.getElementById('modeToggle').classList.toggle('active', learn);
  document.getElementById('modeCardPreview').classList.toggle('selected-mode', !learn);
  document.getElementById('modeCardLearn').classList.toggle('selected-mode', learn);
  applyModeToUI();
}

function applyModeToUI() {
  for (let r = 1; r <= 4; r++) {
    const sec = document.getElementById('analysis' + r);
    const skip = document.getElementById('skipBtn' + r);
    if (!sec) continue;
    if (state.learnMode) {
      sec.style.display = '';
      sec.classList.remove('collapsed');
      skip.style.display = 'none';
    } else {
      sec.style.display = '';
      sec.classList.remove('collapsed');
      skip.style.display = 'block';
    }
    updateConfirmBtnState(r);
  }
}

// ---- UI FUNCTIONS ----
function selectOption(el) {
  const round = parseInt(el.dataset.round);
  const option = el.dataset.option;
  document.querySelectorAll('#round'+round+'Options .option-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  state.choices[round] = option;
  updateConfirmBtnState(round);
}

function updateConfirmBtnState(round) {
  const btn = document.getElementById('btnRound'+round);
  if (!btn) return;
  const hasChoice = !!state.choices[round];
  if (!state.learnMode) {
    btn.disabled = !hasChoice;
  } else {
    const textarea = document.getElementById('analysisText'+round);
    const charsMet = textarea && textarea.value.trim().length >= MIN_CHARS;
    btn.disabled = !(hasChoice && charsMet);
  }
}

function updateCharCount(round) {
  const textarea = document.getElementById('analysisText'+round);
  const counter = document.getElementById('charCount'+round);
  const len = textarea.value.trim().length;
  counter.textContent = len + ' / ' + MIN_CHARS + ' Zeichen' + (len >= MIN_CHARS ? ' \u2713' : ' (Minimum)');
  counter.className = 'char-count ' + (len >= MIN_CHARS ? 'met' : (len > 0 ? 'short' : ''));
  state.analyses[round] = textarea.value;
  updateConfirmBtnState(round);
}

function skipAnalysis(round) {
  // In preview mode, allow skipping
  const textarea = document.getElementById('analysisText'+round);
  if (textarea) textarea.value = '';
  state.analyses[round] = '';
  // Reset character counter display
  const cc = document.getElementById('charCount'+round);
  if (cc) { cc.textContent = '0 / ' + MIN_CHARS + ' Zeichen (Minimum)'; cc.className = 'char-count'; }
  // Force enable since we're in preview mode
  document.getElementById('btnRound'+round).disabled = !state.choices[round];
}

function toggleExample(round) {
  const box = document.getElementById('example'+round);
  box.classList.toggle('visible');
}

function toggleAccordion(id) {
  document.getElementById(id).classList.toggle('open');
}

function updateProgress(roundNum) {
  document.getElementById('progressContainer').style.display='block';
  for(let i=1;i<=4;i++){const s=document.getElementById('step'+i);s.classList.remove('active','completed');if(i<roundNum)s.classList.add('completed');else if(i===roundNum)s.classList.add('active');}
  document.getElementById('progressFill').style.width=((roundNum-1)/3*100)+'%';
}

function updateRoundBadge(round) {
  const labels={0:'Case-Brief',1:'Runde 1/4',2:'Runde 2/4',3:'Runde 3/4',4:'Runde 4/4',5:'Auswertung'};
  document.getElementById('roundBadge').textContent=labels[round]||'';
}

function renderKpiGrid(containerId) {
  const k=state.kpis;
  const prev=state.kpiHistory.length>1?state.kpiHistory[state.kpiHistory.length-2]:null;
  function ci(cur,pre,inv){
    if(pre===undefined||pre===null)return'<span class="kpi-change neutral">\u2014</span>';
    const d=cur-pre;if(d===0)return'<span class="kpi-change neutral">\u00B10</span>';
    const pos=inv?d<0:d>0;const arr=d>0?'\u25B2':'\u25BC';
    return'<span class="kpi-change '+(pos?'positive':'negative')+'">'+arr+' '+Math.abs(d).toFixed(1)+'</span>';
  }
  document.getElementById(containerId).innerHTML=`
    <div class="kpi-card"><span class="kpi-value">${k.roi.toFixed(0)}%</span><span class="kpi-label">ROI</span>${ci(k.roi,prev?.roi,false)}</div>
    <div class="kpi-card"><span class="kpi-value">${k.csat.toFixed(0)}</span><span class="kpi-label">Kundenzufriedenheit (CSAT)</span>${ci(k.csat,prev?.csat,false)}</div>
    <div class="kpi-card"><span class="kpi-value">${k.acceptance.toFixed(0)}</span><span class="kpi-label">Mitarbeiterakzeptanz</span>${ci(k.acceptance,prev?.acceptance,false)}</div>
    <div class="kpi-card"><span class="kpi-value">${k.efficiency.toFixed(0)}%</span><span class="kpi-label">Prozesseffizienz</span>${ci(k.efficiency,prev?.efficiency,false)}</div>
    <div class="kpi-card"><span class="kpi-value">${k.errorRate.toFixed(1)}%</span><span class="kpi-label">Fehlerrate</span>${ci(k.errorRate,prev?.errorRate,true)}</div>
    <div class="kpi-card"><span class="kpi-value">${k.cost.toLocaleString('de-DE')} \u20AC</span><span class="kpi-label">Kumulierte Kosten</span>${ci(k.cost,prev?.cost,true)}</div>`;
}

function renderChart(svgId) {
  const svg=document.getElementById(svgId);if(!svg||state.kpiHistory.length===0)return;
  const w=600,h=200,pad={top:20,right:20,bottom:30,left:50};
  const cW=w-pad.left-pad.right,cH=h-pad.top-pad.bottom;
  const series=[{key:'csat',label:'CSAT',color:'#2b6cb0'},{key:'acceptance',label:'Akzeptanz',color:'#2f855a'},{key:'efficiency',label:'Effizienz',color:'#c05621'}];
  const n=state.kpiHistory.length,xS=n>1?cW/(n-1):cW;
  let s='';
  for(let v=0;v<=100;v+=25){const y=pad.top+cH-(v/100)*cH;s+=`<line x1="${pad.left}" y1="${y}" x2="${w-pad.right}" y2="${y}" stroke="#e2e8f0" stroke-width="1"/>`;s+=`<text x="${pad.left-8}" y="${y+4}" text-anchor="end" font-size="10" fill="#718096">${v}</text>`;}
  const xL=['Start','Runde 1','Runde 2','Runde 3','Runde 4'];
  for(let i=0;i<n;i++){const x=pad.left+(n>1?i*xS:cW/2);s+=`<text x="${x}" y="${h-5}" text-anchor="middle" font-size="9" fill="#718096">${xL[i]||'R'+i}</text>`;}
  series.forEach(sr=>{let pts=[];for(let i=0;i<n;i++){const x=pad.left+(n>1?i*xS:cW/2),val=state.kpiHistory[i][sr.key],y=pad.top+cH-(Math.min(val,100)/100)*cH;pts.push({x,y,val});}
    if(pts.length>1){s+=`<path d="${pts.map((p,i)=>(i===0?'M':'L')+p.x+','+p.y).join(' ')}" fill="none" stroke="${sr.color}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>`;}
    pts.forEach(p=>{s+=`<circle cx="${p.x}" cy="${p.y}" r="4" fill="${sr.color}" stroke="white" stroke-width="2"/>`;});});
  let lx=pad.left;series.forEach(sr=>{s+=`<rect x="${lx}" y="3" width="12" height="3" rx="1.5" fill="${sr.color}"/>`;s+=`<text x="${lx+16}" y="8" font-size="9" fill="#4a5568">${sr.label}</text>`;lx+=80;});
  svg.innerHTML=s;
}

function showFeedback(round,data,score,showContinue) {
  const c=document.getElementById('feedback'+round);
  const cls=score>=22?'good':(score>=16?'ok':'bad');
  const lbl=score>=22?'Sehr gut':(score>=16?'Befriedigend':'Verbesserungswürdig');
  const btn=showContinue?`<div class="btn-container" style="margin-top:1rem;"><button class="btn-primary" onclick="proceedToNextRound(${round+1})">Weiter zu Runde ${round+1} \u2192</button></div>`:'';
  c.innerHTML=`<div class="feedback-panel"><h4>Feedback zu Ihrer Entscheidung</h4><p>${data.feedback||data}</p><div class="feedback-score ${cls}">${score} Punkte \u2013 ${lbl}</div></div>${btn}`;
}

function proceedToNextRound(n){showRound(n);}

function updateBudgetAndScore() {
  document.getElementById('budgetDisplay').textContent=state.kpis.cost.toLocaleString('de-DE')+' EUR';
  document.getElementById('scoreDisplay').textContent=state.totalScore;
}

// ---- CASE INTRO NAV ----
function showCasePanel(idx) {
  document.querySelectorAll('.case-panel').forEach((p,i)=>{p.classList.toggle('active',i===idx);});
  document.querySelectorAll('.case-nav-btn').forEach((b,i)=>{b.classList.toggle('active',i===idx);});
}

// ---- CASE BRIEF MODAL ----
function openCaseBrief() {
  const body=document.getElementById('caseBriefModalBody');
  // Clone panels content
  let html='';
  for(let i=0;i<4;i++){const panel=document.getElementById('casePanel'+i);if(panel)html+=panel.innerHTML;}
  body.innerHTML=html;
  document.getElementById('caseBriefModal').classList.add('open');
  document.body.style.overflow='hidden';
}
function closeCaseBrief() {
  document.getElementById('caseBriefModal').classList.remove('open');
  document.body.style.overflow='';
}

// ---- ROUND LOGIC ----
function startSimulation() {
  document.getElementById('caseIntro').classList.remove('active');
  document.getElementById('caseIntro').style.display='none';
  document.getElementById('companyBar').style.display='flex';
  document.getElementById('caseBriefLink').style.display='';
  state.currentRound=1;
  snapshotKpis();
  updateProgress(1);
  updateRoundBadge(1);
  updateBudgetAndScore();
  applyModeToUI();
  document.getElementById('round1').classList.add('active');
}

function confirmRound(round) {
  const choice=state.choices[round];if(!choice)return;
  let roundData,score,feedbackText;
  if(round===1){roundData=round1Data[choice];score=roundData.score;applyKpiDelta(roundData.kpiDelta);feedbackText=roundData;}
  else if(round===2){roundData=round2Data[choice];score=roundData.score;applyKpiDelta(roundData.kpiDelta);feedbackText=roundData;}
  else if(round===3){roundData=round3Data[choice];score=roundData.score;applyKpiDelta(roundData.kpiDelta);feedbackText=roundData;}
  else if(round===4){roundData=round4Data[choice];score=getRound4Score(choice);applyKpiDelta(roundData.kpiDelta);feedbackText={feedback:getRound4DynamicFeedback(choice)};}
  state.scores.push(score);
  state.totalScore=state.scores.reduce((a,b)=>a+b,0);
  if(round===4){const combo=getComboBonus();state.totalScore+=combo.bonus;state.totalScore=Math.max(0,Math.min(100,state.totalScore));}
  snapshotKpis();updateBudgetAndScore();
  document.getElementById('btnRound'+round).disabled=true;
  document.querySelectorAll('#round'+round+'Options .option-card').forEach(c=>{c.style.pointerEvents='none';if(!c.classList.contains('selected'))c.style.opacity='0.5';});
  // Lock analysis
  const ta=document.getElementById('analysisText'+round);if(ta)ta.disabled=true;
  if(round<4){
    const db=document.getElementById('dashboardMain');db.style.display='block';
    renderKpiGrid('kpiGridMain');renderChart('chartMain');
    showFeedback(round,feedbackText,score,true);
  } else {
    showFeedback(round,feedbackText,score,false);
    setTimeout(()=>{showFinalEvaluation();},800);
  }
}

function showRound(roundNum) {
  state.currentRound=roundNum;updateProgress(roundNum);updateRoundBadge(roundNum);
  for(let i=1;i<=4;i++){const el=document.getElementById('round'+i);el.classList.remove('active');if(i===roundNum){el.classList.add('active');el.scrollIntoView({behavior:'smooth',block:'start'});}}
  if(roundNum===4){renderKpiGrid('kpiGridR4');renderChart('chartR4');document.getElementById('dashboardMain').style.display='none';}
  applyModeToUI();
}

// ---- FINAL EVALUATION ----
function showFinalEvaluation() {
  updateRoundBadge(5);
  for(let i=1;i<=4;i++)document.getElementById('round'+i).classList.remove('active');
  document.getElementById('dashboardMain').style.display='none';
  const fs=document.getElementById('finalSection');fs.classList.add('active');fs.scrollIntoView({behavior:'smooth',block:'start'});
  const bs=document.getElementById('finalBigScore');let cur=0;const tgt=state.totalScore,inc=Math.ceil(tgt/40);
  const tmr=setInterval(()=>{cur=Math.min(cur+inc,tgt);bs.textContent=cur;if(cur>=tgt)clearInterval(tmr);},30);
  const grade=document.getElementById('finalGrade'),label=document.getElementById('finalScoreLabel');
  if(tgt>=85){grade.textContent='Exzellent';label.textContent='Herausragende strategische Entscheidungen';}
  else if(tgt>=70){grade.textContent='Sehr gut';label.textContent='Fundierte und durchdachte Strategie';}
  else if(tgt>=55){grade.textContent='Gut';label.textContent='Solide Entscheidungen mit Optimierungspotenzial';}
  else if(tgt>=40){grade.textContent='Befriedigend';label.textContent='Einige Fehlentscheidungen mit Lernpotenzial';}
  else{grade.textContent='Verbesserungswürdig';label.textContent='Wesentliche strategische Schwächen identifiziert';}
  renderKpiGrid('kpiGridFinal');renderChart('chartFinal');
  const rl={1:{tag:'Runde 1 \u2013 Prozessauswahl',data:round1Data},2:{tag:'Runde 2 \u2013 Build vs. Buy',data:round2Data},3:{tag:'Runde 3 \u2013 Deployment',data:round3Data},4:{tag:'Runde 4 \u2013 Skalierung',data:round4Data}};
  let dh='';for(let r=1;r<=4;r++){const ch=state.choices[r],rd=rl[r].data[ch],imp=r===4?getRound4DynamicFeedback(ch):rd.feedback;
    dh+=`<div class="decision-item"><div class="decision-round">${rl[r].tag}</div><div class="decision-choice">Option ${ch}: ${rd.name}</div><div class="decision-impact">${imp.substring(0,200)}${imp.length>200?'...':''}</div></div>`;}
  document.getElementById('decisionList').innerHTML=dh;
  document.getElementById('learningList').innerHTML=generateLearnings().map(l=>'<li>'+l+'</li>').join('');
}

function generateLearnings() {
  const ls=[],c=state.choices;
  if(c[1]==='A')ls.push('Sie haben den Prozess mit dem höchsten Automatisierungspotenzial und der direktesten Verbindung zum Kernproblem gewählt \u2013 ein Zeichen für strategisches Denken.');
  else if(c[1]==='C')ls.push('Wichtige Erkenntnis: Bei der Prozessauswahl sollte immer der Prozess priorisiert werden, der das Kernproblem des Unternehmens am direktesten adressiert.');
  else ls.push('Supply Chain Forecasting bietet zwar guten ROI, adressiert aber das akute Kundenproblem nur indirekt. Bei der Prozessauswahl zählt die Nähe zum Kernproblem.');
  if(c[2]==='A')ls.push('Eigenentwicklung kann langfristig vorteilhaft sein, ist aber für Mittelständler oft zu ressourcenintensiv. Build-Entscheidungen sollten immer die verfügbaren Kapazitäten berücksichtigen.');
  else if(c[2]==='B')ls.push('SaaS-Lösungen bieten schnelle Time-to-Market, aber Vendor Lock-in ist ein reales Risiko. Die Total Cost of Ownership über 3\u20135 Jahre sollte immer kalkuliert werden.');
  else ls.push('Der Hybrid-Ansatz balanciert Geschwindigkeit und Flexibilität \u2013 ein pragmatischer Ansatz, der im Mittelstand häufig die beste Wahl darstellt.');
  if(c[3]==='C')ls.push('Big-Bang-Einführungen scheitern häufig an mangelndem Change Management. Die Fehlerwahrscheinlichkeit steigt exponentiell mit dem Umfang der gleichzeitigen Veränderung.');
  else if(c[3]==='A')ls.push('Pilotprojekte minimieren Risiken und schaffen interne Champions, die als Multiplikatoren wirken. Der langsamere ROI wird durch höhere Erfolgswahrscheinlichkeit kompensiert.');
  else ls.push('Schrittweise Einführungen erfordern gutes Projektmanagement, bieten aber einen guten Kompromiss aus Geschwindigkeit und Risikominimierung.');
  if(c[4]==='A'&&state.kpis.acceptance<60)ls.push('Skalierung bei niedriger Mitarbeiterakzeptanz ist riskant. Vor einer Expansion sollten interne Widerstände adressiert werden.');
  else if(c[4]==='B')ls.push('Konsolidierung nach einer erfolgreichen Einführung schafft eine stabile Basis für spätere Skalierung \u2013 ein oft unterschätzter strategischer Schritt.');
  ls.push('KI-Projekte im Mittelstand erfordern immer eine Balance aus technischer Innovation, finanzieller Tragfähigkeit und organisatorischem Change Management.');
  return ls;
}

function showDetailedAnalysis() {
  const c=document.getElementById('detailedAnalysis');
  if(c.style.display==='block'){c.style.display='none';return;}
  const combo=getComboBonus();
  let ch=combo.notes.length>0?combo.notes.map(n=>'<li>'+n+'</li>').join(''):'<li>Keine besonderen Synergien oder Konflikte zwischen Ihren Entscheidungen identifiziert.</li>';
  let sb='';const rn=['Prozessauswahl','Build vs. Buy','Deployment','Skalierung'],rm=[28,25,24,28];
  state.scores.forEach((s,i)=>{const p=(s/rm[i])*100;
    sb+=`<div style="margin-bottom:.5rem;"><div style="display:flex;justify-content:space-between;font-size:.85rem;margin-bottom:.2rem;"><span>Runde ${i+1}: ${rn[i]}</span><span style="font-weight:700;">${s} Pkt.</span></div><div style="background:var(--gray-200);height:8px;border-radius:4px;overflow:hidden;"><div style="background:var(--primary-light);height:100%;width:${Math.min(p,100)}%;border-radius:4px;transition:width .5s;"></div></div></div>`;});
  if(combo.bonus!==0){sb+=`<div style="margin-bottom:.5rem;"><div style="display:flex;justify-content:space-between;font-size:.85rem;margin-bottom:.2rem;"><span>Kombinations-Bonus</span><span style="font-weight:700;color:${combo.bonus>=0?'var(--accent)':'var(--danger)'};">${combo.bonus>0?'+':''}${combo.bonus} Pkt.</span></div></div>`;}

  // Include analyses if any
  let aHtml='';
  for(let r=1;r<=4;r++){if(state.analyses[r]&&state.analyses[r].trim().length>0){
    aHtml+=`<div class="decision-item"><div class="decision-round">Analyse Runde ${r}</div><div class="decision-impact" style="white-space:pre-wrap;">${state.analyses[r]}</div></div>`;}}
  const analysisSection=aHtml?`<div class="decision-summary" style="margin-top:1rem;"><h3>Ihre Analysen</h3>${aHtml}</div>`:'';

  c.innerHTML=`
    <div class="decision-summary"><h3>Detaillierte Punkteanalyse</h3>${sb}<div style="margin-top:1rem;padding-top:.75rem;border-top:1px solid var(--gray-200);display:flex;justify-content:space-between;font-weight:700;"><span>Gesamtscore</span><span>${state.totalScore} / 100</span></div></div>
    <div class="decision-summary" style="margin-top:1rem;"><h3>Entscheidungs-Synergien</h3><ul style="padding-left:1.2rem;font-size:.88rem;color:var(--gray-600);">${ch}</ul></div>
    <div class="decision-summary" style="margin-top:1rem;"><h3>Kostenübersicht</h3><p style="font-size:.88rem;color:var(--gray-600);">Ihre kumulierten Kosten betragen <strong>${state.kpis.cost.toLocaleString('de-DE')} EUR</strong>. Bei einem ROI von ${state.kpis.roi.toFixed(0)}% und einer Prozesseffizienzsteigerung von ${state.kpis.efficiency.toFixed(0)}% ${state.kpis.roi>30?'ist dies eine wirtschaftlich tragfähige Investition.':'besteht noch erhebliches Optimierungspotenzial.'}</p><p style="font-size:.85rem;color:var(--gray-500);margin-top:.5rem;">Zum Vergleich: Die jährlichen Customer-Service-Kosten der TechSupply GmbH betragen 420.000 EUR. Ihre KI-Investition entspricht ${(state.kpis.cost/420000*100).toFixed(1)}% dieser Jahreskosten.</p></div>
    ${analysisSection}`;
  c.style.display='block';c.scrollIntoView({behavior:'smooth',block:'start'});
}

// ---- RESTART ----
function restartSimulation() {
  state.currentRound=0;state.choices={};state.scores=[];state.totalScore=0;state.kpiHistory=[];
  state.kpis={roi:0,csat:62,acceptance:70,efficiency:0,errorRate:12,cost:0};state.analyses={};
  state.learnMode=false;
  document.getElementById('modeToggle').classList.remove('active');
  document.getElementById('finalSection').classList.remove('active');
  document.getElementById('companyBar').style.display='none';
  document.getElementById('progressContainer').style.display='none';
  document.getElementById('dashboardMain').style.display='none';
  document.getElementById('detailedAnalysis').style.display='none';
  document.getElementById('caseBriefLink').style.display='none';
  for(let r=1;r<=4;r++){
    document.getElementById('round'+r).classList.remove('active');
    document.getElementById('feedback'+r).innerHTML='';
    document.getElementById('btnRound'+r).disabled=true;
    document.querySelectorAll('#round'+r+'Options .option-card').forEach(c=>{c.classList.remove('selected');c.style.pointerEvents='';c.style.opacity='';});
    const ta=document.getElementById('analysisText'+r);if(ta){ta.value='';ta.disabled=false;}
    const ex=document.getElementById('example'+r);if(ex)ex.classList.remove('visible');
    const cc=document.getElementById('charCount'+r);if(cc){cc.textContent='0 / '+MIN_CHARS+' Zeichen (Minimum)';cc.className='char-count';}
    const acc=document.getElementById('acc'+r+'ctx');if(acc)acc.classList.remove('open');
  }
  updateBudgetAndScore();
  document.getElementById('kpiGridR4').innerHTML='';
  document.getElementById('chartR4').innerHTML='';
  const intro=document.getElementById('caseIntro');
  intro.style.display='';intro.classList.add('active');
  showCasePanel(0);
  document.getElementById('modeCardPreview').classList.remove('selected-mode');
  document.getElementById('modeCardLearn').classList.remove('selected-mode');
  updateRoundBadge(0);
  window.scrollTo({top:0,behavior:'smooth'});
}

// Close modal on overlay click
document.getElementById('caseBriefModal').addEventListener('click',function(e){if(e.target===this)closeCaseBrief();});
</script>
</body>
</html>
